# ğŸš€ Case Management Enhancements - Phase 2

## Issues Reported
1. âŒ Case ID/Number under "Create New Case" could not be edited after selecting files
2. âŒ File selection popup window does not have file sorting function like Files tab

---

## âœ… Issue 1: Case ID Field - FIXED

### Problem
- Case ID was **auto-generated only** from Case Name
- No visible input field for users to view or edit the Case ID
- Users couldn't customize the Case ID before creating a case

### Solution Implemented

#### Added Editable Case ID Field âœ…
**Location**: `CaseManagementModal.tsx`

**New Features**:
1. **New State Variable**: Added `caseId` to form state
2. **Dedicated Input Field**: Case ID now has its own input field above Case Name
3. **Smart Auto-Generation**: Auto-generates from Case Name as you type, but allows manual editing
4. **Edit Mode Protection**: Case ID cannot be changed in edit mode (disabled field)

**Code Changes**:
```typescript
// 1. Added caseId state
const [caseId, setCaseId] = useState('');

// 2. Auto-generate Case ID when Case Name changes (only in create mode)
<Input
  value={caseName}
  onChange={(_, data) => {
    setCaseName(data.value);
    // Auto-generate Case ID from Case Name only in create mode
    if (mode === 'create') {
      const autoGeneratedId = generateCaseId(data.value);
      // Only update if user hasn't manually edited the Case ID
      if (!caseId || caseId === generateCaseId(caseName)) {
        setCaseId(autoGeneratedId);
      }
    }
  }}
/>

// 3. Case ID Input Field (new!)
<Input
  value={caseId}
  onChange={(_, data) => setCaseId(data.value)}
  placeholder="e.g., Q4-CONTRACT-COMPLIANCE"
  disabled={mode === 'edit' || isLoading} // Can't edit after creation
/>
```

**Auto-Generation Logic**:
```typescript
const generateCaseId = (name: string): string => {
  return name
    .trim()
    .toUpperCase()
    .replace(/[^A-Z0-9\s]/g, '')
    .replace(/\s+/g, '-')
    .substring(0, 50) || 'CASE-' + Date.now();
};
```

**Example**:
- User types Case Name: `"Q4 Contract Compliance Review"`
- Case ID auto-fills: `"Q4-CONTRACT-COMPLIANCE-REVIEW"`
- User can edit to: `"Q4-CONTRACTS"` (manual override)
- Once edited manually, auto-generation stops for that field

**Validation**:
- Case ID is now **required** (added to `validateForm()`)
- Case ID cannot be empty when saving

---

## âœ… Issue 2: File Sorting in FileSelectorDialog - FIXED

### Problem
- FileSelectorDialog had **no sorting functionality**
- Files were displayed in upload order only
- FilesTab has excellent sorting by Name/Size/Date, but FileSelectorDialog didn't

### Solution: Reused FilesTab Sorting Code âœ…

**Location**: `FileSelectorDialog.tsx`

**What Was Added**:

#### 1. **Sorting Utility Function** (Copy from FilesTab)
```typescript
// REUSE: Sorting utility from FilesTab
const sortFiles = (
  files: any[], 
  sortColumn: 'name' | 'size' | 'uploadedAt', 
  sortDirection: 'asc' | 'desc'
): any[] => {
  return [...files].sort((a, b) => {
    let aValue: any;
    let bValue: any;
    
    switch (sortColumn) {
      case 'name':
        aValue = (a.name || '').toLowerCase();
        bValue = (b.name || '').toLowerCase();
        break;
      case 'size':
        aValue = a.size || 0;
        bValue = b.size || 0;
        break;
      case 'uploadedAt':
        aValue = a.uploadedAt ? new Date(a.uploadedAt).getTime() : 0;
        bValue = b.uploadedAt ? new Date(b.uploadedAt).getTime() : 0;
        break;
    }
    
    if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;
    if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;
    return 0;
  });
};
```

#### 2. **Sorting State** (Copy from FilesTab)
```typescript
const [sortColumn, setSortColumn] = useState<'name' | 'size' | 'uploadedAt'>('name');
const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('asc');
```

#### 3. **Sorted Files with useMemo** (Copy from FilesTab)
```typescript
const sortedFiles = useMemo(() => {
  return sortFiles(filteredFiles, sortColumn, sortDirection);
}, [filteredFiles, sortColumn, sortDirection]);
```

#### 4. **Column Click Handler** (Copy from FilesTab)
```typescript
const handleColumnClick = (column: 'name' | 'size' | 'uploadedAt') => {
  if (sortColumn === column) {
    setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
  } else {
    setSortColumn(column);
    setSortDirection('asc');
  }
};
```

#### 5. **New Table-Like Layout with Sortable Headers**

**Before** (Simple List):
```tsx
{filteredFiles.map((file) => (
  <div className={styles.fileItem}>
    <Checkbox ... />
    <div className={styles.fileInfo}>
      <Text>ğŸ“„ {file.name}</Text>
      <Text>Size: X KB â€¢ Uploaded: Date</Text>
    </div>
  </div>
))}
```

**After** (Table with Sortable Headers):
```tsx
{/* Header Row with Sort Indicators */}
<div className={styles.fileListHeader}>
  <div><Checkbox ... /></div>
  <div onClick={() => handleColumnClick('name')}>
    Name {sortColumn === 'name' && <ArrowUpRegular/ArrowDownRegular />}
  </div>
  <div onClick={() => handleColumnClick('size')}>
    Size {sortColumn === 'size' && <ArrowUpRegular/ArrowDownRegular />}
  </div>
  <div onClick={() => handleColumnClick('uploadedAt')}>
    Uploaded {sortColumn === 'uploadedAt' && <ArrowUpRegular/ArrowDownRegular />}
  </div>
</div>

{/* File Rows */}
{sortedFiles.map((file) => (
  <div className={styles.fileItem}>
    <div><Checkbox ... /></div>
    <div>ğŸ“„ {file.name}</div>
    <div>{file.size} KB</div>
    <div>{formatDate(file.uploadedAt)}</div>
  </div>
))}
```

#### 6. **Visual Improvements**

**New Styles** (Matching FilesTab):
```typescript
fileListContainer: {
  border: `1px solid ${tokens.colorNeutralStroke2}`,
  borderRadius: tokens.borderRadiusMedium,
  overflow: 'hidden',
},
fileListHeader: {
  display: 'grid',
  gridTemplateColumns: '40px 1fr 100px 120px', // Checkbox | Name | Size | Date
  backgroundColor: tokens.colorNeutralBackground3,
  fontWeight: tokens.fontWeightSemibold,
},
columnHeader: {
  display: 'flex',
  alignItems: 'center',
  cursor: 'pointer',
  ':hover': { color: tokens.colorBrandForeground1 },
},
fileItem: {
  display: 'grid',
  gridTemplateColumns: '40px 1fr 100px 120px', // Match header
  borderBottom: `1px solid ${tokens.colorNeutralStroke2}`,
}
```

**Increased Dialog Width**: `600px` â†’ `700px` to accommodate columns

**Icons Added**:
```typescript
import { ArrowUpRegular, ArrowDownRegular } from '@fluentui/react-icons';
```

---

## Visual Comparison

### Before (FileSelectorDialog)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Search: [___________]               â”‚
â”‚ [Select All] [Clear All]            â”‚
â”‚                                     â”‚
â”‚ â˜‘ ğŸ“„ contract.pdf                   â”‚
â”‚    45.2 KB â€¢ Uploaded 10/12/2025    â”‚
â”‚                                     â”‚
â”‚ â˜ ğŸ“„ invoice.xlsx                   â”‚
â”‚    12.8 KB â€¢ Uploaded 10/11/2025    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After (FileSelectorDialog with Sorting)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Search: [___________]                             â”‚
â”‚ [Select All (15)] [Clear All]                     â”‚
â”‚                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â˜‘ â”‚ Name â–²         â”‚ Size    â”‚ Uploaded    â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ â˜‘ â”‚ ğŸ“„ contract.pdfâ”‚ 45.2 KB â”‚ Oct 12      â”‚  â”‚
â”‚ â”‚ â˜ â”‚ ğŸ“„ invoice.xlsxâ”‚ 12.8 KB â”‚ Oct 11      â”‚  â”‚
â”‚ â”‚ â˜‘ â”‚ ğŸ“„ memo.docx   â”‚ 8.5 KB  â”‚ Oct 13      â”‚  â”‚
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                   â”‚
â”‚ âœ“ 2 files selected                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features**:
- âœ… Click column headers to sort
- âœ… Arrow indicators show sort direction (â–² asc, â–¼ desc)
- âœ… Grid layout aligns data columns
- âœ… Header checkbox to select/deselect all
- âœ… Matches FilesTab design language

---

## Code Reuse Summary

### FilesTab.tsx â†’ FileSelectorDialog.tsx

| Component | Reused From FilesTab |
|-----------|----------------------|
| `sortFiles()` function | âœ… 100% copied |
| Sort state (`sortColumn`, `sortDirection`) | âœ… 100% pattern match |
| `useMemo` for sorted files | âœ… 100% pattern match |
| Column click handler logic | âœ… 100% pattern match |
| Arrow icons (`ArrowUpRegular`, `ArrowDownRegular`) | âœ… Same imports |
| Grid layout for table-like display | âœ… Adapted from FilesTab table |
| Sort indicators in headers | âœ… Same visual pattern |

**Reuse Percentage**: **~95%** of sorting logic directly copied from FilesTab

---

## Files Modified

### 1. `CaseManagementModal.tsx`
**Changes**:
- âœ… Added `caseId` state variable
- âœ… Added Case ID input field (before Case Name)
- âœ… Smart auto-generation from Case Name (with manual override)
- âœ… Disabled Case ID editing in edit mode
- âœ… Added Case ID validation (required)
- âœ… Updated hint text to explain auto-generation

**Lines Changed**: ~30 lines added/modified

### 2. `FileSelectorDialog.tsx`
**Changes**:
- âœ… Added `sortFiles()` utility function
- âœ… Added sorting state (`sortColumn`, `sortDirection`)
- âœ… Added `useMemo` for sorted files
- âœ… Added `handleColumnClick()` handler
- âœ… Redesigned file list as sortable table
- âœ… Added sortable column headers with click handlers
- âœ… Added arrow icons for sort indicators
- âœ… Updated styles for grid layout
- âœ… Imported `ArrowUpRegular`, `ArrowDownRegular` icons
- âœ… Increased dialog width to 700px

**Lines Changed**: ~80 lines added/modified

---

## Testing Checklist

### âœ… Case ID Field
- [ ] Open "Create New Case" modal
- [ ] Verify Case ID field appears **above** Case Name field
- [ ] Type in Case Name (e.g., "Test Case 123")
- [ ] Verify Case ID auto-fills (e.g., "TEST-CASE-123")
- [ ] Edit Case ID manually (e.g., "TC-123")
- [ ] Continue typing in Case Name
- [ ] Verify Case ID **does not** auto-update after manual edit
- [ ] Clear Case ID field
- [ ] Verify validation prevents saving (Case ID required)
- [ ] Edit an existing case
- [ ] Verify Case ID field is **disabled** (grayed out)

### âœ… File Sorting in Selector
- [ ] Click "Select from Library" button
- [ ] Verify FileSelectorDialog opens with table layout
- [ ] Verify columns: Checkbox | Name | Size | Uploaded
- [ ] Click "Name" column header
- [ ] Verify files sort alphabetically A-Z
- [ ] Click "Name" header again
- [ ] Verify files sort reverse Z-A
- [ ] Verify arrow icon changes (â–² â†’ â–¼)
- [ ] Click "Size" column header
- [ ] Verify files sort by size (smallest first)
- [ ] Click "Size" again â†’ largest first
- [ ] Click "Uploaded" column header
- [ ] Verify files sort by date (oldest first)
- [ ] Click "Uploaded" again â†’ newest first
- [ ] Search for a file name
- [ ] Verify search + sort work together
- [ ] Click header checkbox
- [ ] Verify all filtered/sorted files are selected

---

## Benefits

### Case ID Editing
1. âœ… **User Control**: Users can customize Case IDs to match their naming conventions
2. âœ… **Convenience**: Auto-generation provides a sensible default
3. âœ… **Smart Logic**: Only auto-generates when user hasn't manually edited
4. âœ… **Data Integrity**: Case ID locked after creation (prevents breaking references)
5. âœ… **Clear Feedback**: Hint text explains the behavior

### File Sorting
1. âœ… **Consistency**: FileSelectorDialog now matches FilesTab UX
2. âœ… **Code Reuse**: 95% of sorting code copied from FilesTab (no reinventing)
3. âœ… **User Productivity**: Easy to find files by name, size, or recency
4. âœ… **Visual Clarity**: Table layout makes metadata scannable
5. âœ… **Professional UI**: Matches enterprise file management patterns

---

## Status

âœ… **ALL ISSUES FIXED**

- âœ… Case ID field added and editable
- âœ… Smart auto-generation from Case Name
- âœ… Case ID validation added
- âœ… File sorting functionality added to FileSelectorDialog
- âœ… Sortable column headers with visual indicators
- âœ… Table-like layout matching FilesTab design
- âœ… Zero TypeScript compilation errors
- âœ… 95% code reuse from existing FilesTab implementation

**Ready for testing and deployment!** ğŸš€
