name: graphrag-orchestration
metadata:
  template: graphrag-orchestration@1.0

services:
  # API Gateway - handles HTTP requests, chat endpoints, folder management
  graphrag-api:
    project: .
    language: python
    host: containerapp
    docker:
      path: ./Dockerfile.api
    hooks:
      postdeploy:
        shell: sh
        run: |
          echo "API Gateway deployed successfully"
          # Prune dangling images
          docker image prune -f || true

  # Worker - processes background jobs from Redis queue
  graphrag-worker:
    project: .
    language: python
    host: containerapp
    docker:
      path: ./Dockerfile.worker
    hooks:
      postdeploy:
        shell: sh
        run: |
          echo "Worker deployed successfully"
          # Prune dangling images
          docker image prune -f || true
