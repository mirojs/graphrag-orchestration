# Handover - February 5, 2026

## Summary

Reviewed Route 3 and Route 4 for potential improvements, applied upstream fix, cleaned up container app revisions.

---

## Completed Today

### 1. Route 3 Improvement Plan
- **File:** [PLAN_ROUTE3_IMPROVEMENTS_2026-02-05.md](PLAN_ROUTE3_IMPROVEMENTS_2026-02-05.md)
- **Scope:** Port Route 4's enhanced coverage gap fill to Route 3
- **Changes planned:**
  - Add document-level tracking (`existing_docs` set)
  - Dynamic sizing based on corpus
  - Early exit when full coverage achieved
  - Comprehensive query detection ("list all", "summarize across")
- **Status:** Plan documented, code not yet implemented

### 2. Route 2 Assessment
- **Verdict:** Keep as-is (100% accuracy, stable)
- **Reason:** No improvements needed; section-aware diversification already on roadmap

### 3. Upstream Fix Applied
- **Commit:** `ff018f73` - Cherry-pick upstream fix 8883e727
- **Fix:** Multimodal image download from non-default blob container
- **Files updated:**
  - `frontend/app/backend/approaches/approach.py`
  - `frontend/app/backend/prepdocslib/blobmanager.py`
  - `frontend/tests/test_app.py`
  - `frontend/UPSTREAM_VERSION.md`

### 4. Container URL Migration
- **Commit:** `35582bd6`
- **Change:** Updated 47 files from deprecated `graphrag-orchestration` URL to `graphrag-api`
- **Correct architecture:**
  - `graphrag-api` = Frontend (external, auth required)
  - `graphrag-worker` = Backend (internal only)
  - `graphrag-orchestration` = Deprecated

### 5. Container App Cleanup
- **App:** `graphrag-api`
- **Before:** 28 active revisions (all running)
- **After:** 1 active revision (`graphrag-api--azd-1770281048`)
- **Benefit:** Cleaner log streaming, reduced resource consumption

### 6. Evaluation Assessment
- **Current state:** Functional but could be improved
- **Verdict:** Skip tooling complexity for now (100% accuracy on 5-PDF corpus)
- **Future backlog:**
  - Expanded test corpus (20+ documents)
  - Latency threshold assertions in CI
  - Negative test audit (Q-N* coverage)

---

## Current Infrastructure

| Component | URL/Name | Status |
|-----------|----------|--------|
| **Frontend (B2B)** | `graphrag-api.salmonhill-df6033f3.swedencentral.azurecontainerapps.io` | ✅ Running |
| **Frontend (B2C)** | `graphrag-api-b2c.salmonhill-df6033f3.swedencentral.azurecontainerapps.io` | ✅ Running |
| **Backend Worker** | `graphrag-worker.internal.salmonhill-df6033f3...` | ✅ Internal |
| **Auth App ID** | `api://b68b6881-80ba-4cec-b9dd-bd2232ec8817` | B2B Entra ID |
| **Test Group** | `test-5pdfs-v2-fix2` | 5 PDFs indexed |

---

## Pending Upstream PR

- **PR #2953:** Prompty → Jinja2 migration
- **Status:** Open (not merged)
- **Action:** Wait until merged, then evaluate for sync

---

## Todo List

### High Priority
- [ ] **Implement Route 3 improvements** - Apply changes from [PLAN_ROUTE3_IMPROVEMENTS_2026-02-05.md](PLAN_ROUTE3_IMPROVEMENTS_2026-02-05.md)
- [ ] **Run Route 4 benchmark** - 3 repeats with `test-5pdfs-v2-fix2` group
- [ ] **Verify log stream** - Confirm Azure Portal now shows logs for `graphrag-api`

### Medium Priority
- [ ] **Clean up `graphrag-worker` revisions** - May have same multi-revision issue
- [ ] **Clean up `graphrag-orchestration` revisions** - If still used

### Low Priority (Backlog)
- [ ] Expand test corpus to 20+ documents
- [ ] Add latency thresholds to CI
- [ ] Audit Q-N* negative tests
- [ ] Sync upstream PR #2953 when merged

---

## Quick Commands

### Run Route 4 Benchmark
```bash
cd /afh/projects/graphrag-orchestration
python scripts/benchmark_route4_drift_multi_hop.py --repeats 3 --group-id test-5pdfs-v2-fix2
```

### Get Auth Token
```bash
az account get-access-token --resource api://b68b6881-80ba-4cec-b9dd-bd2232ec8817 --query accessToken -o tsv
```

### Test API Health
```bash
TOKEN=$(az account get-access-token --resource api://b68b6881-80ba-4cec-b9dd-bd2232ec8817 --query accessToken -o tsv)
curl -H "Authorization: Bearer $TOKEN" https://graphrag-api.salmonhill-df6033f3.swedencentral.azurecontainerapps.io/health
```

### View Container Logs
```bash
az containerapp logs show --name graphrag-api --resource-group rg-graphrag-feature --tail 50
```

---

## Git Status

```
Latest commits:
35582bd6 - chore: Update deprecated graphrag-orchestration URL to graphrag-api
ff018f73 - Cherry-pick upstream fix 8883e727
d3f5a7aa - Add Route 3 improvement plan
```

All changes pushed to `main`.
